name: Deploy Monitoring

on:
  workflow_dispatch:  # Manual trigger only
  push:
    branches: [main]
    paths: 
      - 'backend/monitoring/**'
      - '.github/workflows/cd/monitoring-cd.yml'

jobs:
  deploy-monitoring:
    runs-on: ubuntu-latest
    environment: production
    steps:
    - name: Deploy monitoring stack to CapRover
      uses: caprover/deploy-from-github@v1.1.0
      with:
        server: '${{ secrets.CAPROVER_SERVER }}'
        app: 'bidgallery-monitoring'
        token: '${{ secrets.CAPROVER_APP_TOKEN }}'
        image: 'caprover/grafana:latest'  # Or custom monitoring image