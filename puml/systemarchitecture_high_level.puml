@startuml system_architechture

!define RECTANGLE class
skinparam defaultFontName Arial
skinparam roundCorner 10
skinparam classBackgroundColor White
skinparam classBorderColor Black
skinparam shadowing false

actor "a) User" as user #LightBlue 

rectangle "b) Client Browser\n(React SPA)" as browser #LightBlue

node "c) Ubuntu Server" #LightBlue {
    rectangle "c1) NGINIX \n(API Gateway & Load Balancer))\n" as nginx #Pink
    
    package "NGINX web server" as ws #LightCyan{
        rectangle "c2) React + TS\n(Vite Build)" as fe #Pink
    }

    package "Backend API + embedded tomcat" #LightCyan{
        rectangle "c3) Spring Boot REST API" as api #Pink
    }
    
    package "Observability" #LightCyan{
        rectangle "c5) Loki" as log #Pink
        rectangle "c6) Prometheus" as mon  #Pink
        rectangle "c7) Grafana" as gaf #Pink
    }
    
    database "c4) MariaDB *\nUsers, Artists, Address, Products, Orders, OrderItems" as db #Pink
}

package "d) External Services" #LightBlue {
    rectangle "d1)Payment API" as payment #Pink
    rectangle "d2)OAuth API" as auth #Pink
}

' --- CORRECT FLOW ---
user --> browser
browser --> nginx : **HTTPS request**
nginx -> gaf: **GET**
nginx -right-> fe: **GET** \nReact APP
nginx -->api: **API Calls** 


api --> db : **SQL Queries**  

' Observability
api --> log : **Logs**
api --> mon : **Metrics** 
log --> gaf : Log \nAnalysis
mon --> gaf : Metrics \nDashboard

' External Services
api --> payment : **Payment Processing**\nPOST paymentsIntent
api --> auth : **OAuth Flow**\nPOST /verify user token

' Additional notes for clarity
note left of api
  **API Endpoints:**
  • Authentication: /api/auth/**
  • Products: /api/products/**
  • Bidding: /api/checkout/placebid**
  • PlaceOrder: /api/checkout/placeorder**
end note

note right of nginx
  **NGINX Routes:**
  • / → React App (static)
  • /api/* → Spring Boot API
    - dev.domain.com → :8080 (development)
    - domain.com → :8081-8082 (production)
  • /grafana → Grafana dashboard
end note

@enduml